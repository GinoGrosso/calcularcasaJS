// Guardar resultados en localStorage
function saveToLocalStorage(data) {
    let historial = JSON.parse(localStorage.getItem("historial")) || [];
    historial.push(data);
    localStorage.setItem("historial", JSON.stringify(historial));
}

// Cargar historial desde localStorage
function loadFromLocalStorage() {
    return JSON.parse(localStorage.getItem("historial")) || [];
}

// Enviar datos a un servidor (simulación con JSONPlaceholder)
async function sendData(data) {
    try {
        const response = await fetch("https://jsonplaceholder.typicode.com/posts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });
        const result = await response.json();
        console.log("Datos enviados:", result);
    } catch (error) {
        console.error("Error al enviar:", error);
    }
}

function performOperation() {
    // Get data from the DOM
    const distancia = parseFloat(document.getElementById('distancia').value);
    const precio = parseFloat(document.getElementById('precio').value);
    const tamanio = parseFloat(document.getElementById('tamanio').value);

    // Perform calculations
    const result = calcularValor(precio, tamanio, distancia);
    const explicacion = calcularExplicacion(precio, tamanio, distancia);
    const percentil = calcularPercentil(result);

    // Represent data in the DOM
    document.getElementById('percentil').innerHTML = percentil;
    document.getElementById('result').innerText = `Result: ${result}`;
    document.getElementById('explicacion').innerHTML = explicacion;

    document.getElementById('percentil').className = "bad";
    if (result > -0.4) {
        document.getElementById('percentil').className = "mid";
    }
    if (result > -0.18) {
        document.getElementById('percentil').className = "good";
    }

    // Crear objeto con la operación realizada
    const data = {
        precio,
        tamanio,
        distancia,
        result,
        percentil,
        explicacion
    };

    // Guardar en localStorage
    saveToLocalStorage(data);

    // Enviar con fetch
    sendData(data);
}